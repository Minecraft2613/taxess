<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Local Player Tax</title>
  <style>
    body { background: #111; color: white; font-family: sans-serif; padding: 20px; }
    .box { max-width: 600px; margin: auto; background: #222; padding: 20px; border-radius: 10px; }
    input, button { width: 100%; padding: 10px; margin: 10px 0; font-size: 16px; }
    button { background: #ffaa00; color: #000; font-weight: bold; cursor: pointer; }
  </style>
</head>
<body>
  <div class="box">
    <h1>Check Player Tax (Offline)</h1>
    <input id="mcid" placeholder="Enter Minecraft Username" />
    <button onclick="checkTax()">Check Tax</button>
    <div id="result" style="margin-top: 20px;"></div>
  </div>

  <script>
    async function checkTax() {
      const username = document.getElementById("mcid").value.trim();
      if (!username) return alert("Please enter a username");

      try {
        const res = await fetch("transaction-log.txt");
        const text = await res.text();

        const lines = text.split(/\r?\n/);
        let buyTax = 0, sellTax = 0;

        lines.forEach(line => {
          if (line.includes(username)) {
            const buyMatch = line.match(/\$([\d,]+\.\d+).*bought/);
            const sellMatch = line.match(/\$([\d,]+\.\d+).*sold/);
            if (buyMatch) buyTax += parseFloat(buyMatch[1].replace(/,/g, '')) * 0.04;
            if (sellMatch) sellTax += parseFloat(sellMatch[1].replace(/,/g, '')) * 0.10;
          }
        });

        const totalTax = buyTax + sellTax;

        document.getElementById("result").innerHTML =
          totalTax === 0
            ? `<p>No tax found for player <strong>${username}</strong>.</p>`
            : `<p><strong>${username}</strong>'s Tax Summary:<br>
               Buying Tax: $${buyTax.toFixed(2)}<br>
               Selling Tax: $${sellTax.toFixed(2)}<br>
               <b>Total Tax:</b> $${totalTax.toFixed(2)}</p>`;

      } catch (e) {
        document.getElementById("result").innerHTML = "‚ùå Error loading file.";
        console.error(e);
      }
    }
  </script>
</body>
</html>
