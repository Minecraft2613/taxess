<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üõ†Ô∏è Admin Panel</title>
  <style>
    body { background: #000; color: #fff; font-family: Arial; margin: 0; padding: 20px; }
    h2, h3 { color: orange; text-shadow: 0 0 5px orange; }
    input, button { padding: 8px; margin: 6px; border-radius: 5px; border: none; }
    input { background: #111; color: #fff; }
    button { background: orange; color: black; cursor: pointer; font-weight: bold; }
    button:hover { background: gold; }
    .section { margin: 20px 0; padding: 10px; border: 1px solid #444; border-radius: 6px; background: #111; box-shadow: 0 0 10px orange; }
    .hidden { display: none; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px; border-bottom: 1px solid #333; text-align: left; }
    .player-box { margin: 10px 0; padding: 10px; border: 1px solid #666; background: #111; box-shadow: 0 0 5px orange; }
    label { display: block; margin-top: 8px; font-size: 14px; }
  </style>
</head>
<body>
  <div id="loginBox">
    <h2>üîê Admin Login</h2>
    <label for="adminId">Admin ID</label>
    <input id="adminId" name="adminId" placeholder="Admin ID" />
    <label for="adminPass">Password</label>
    <input id="adminPass" name="adminPass" type="password" placeholder="Password" />
    <button onclick="adminLogin()">Login</button>
  </div>

  <div id="adminPanel" class="hidden">
    <h2>üõ†Ô∏è Admin Panel</h2>
    <button onclick="showSection('taxPayments')">1Ô∏è‚É£ Player Tax Payment</button>
    <button onclick="showSection('bankInfo')">2Ô∏è‚É£ Bank Information</button>
    <button onclick="syncData('tax')">3Ô∏è‚É£ Sync Tax</button>
    <button onclick="syncData('bank')">4Ô∏è‚É£ Sync Bank</button>
    <button onclick="location.reload()">5Ô∏è‚É£ Exit</button>

    <div id="taxPayments" class="section hidden">
      <h3>üìã All Players (Tax Summary)</h3>
      <div id="playerList"></div>
    </div>

    <div id="bankInfo" class="section hidden">
      <h3>üè¶ Bank Information</h3>
      <div id="bankList"></div>
    </div>
  </div>

  <script>
    const adminJsonURL = "https://raw.githubusercontent.com/Minecraft2613/taxess/main/admin.json";
    const taxURL = "https://raw.githubusercontent.com/Minecraft2613/taxess/main/tax-data.json";
    const bankURL = "https://raw.githubusercontent.com/Minecraft2613/taxess/main/bank-data.json";
    const syncTaxURL = "https://syncs.1987sakshamsingh.workers.dev/";
    const syncBankURL = "https://b-syncs.1987sakshamsingh.workers.dev/";

    let taxData = {}, bankData = {}, currentPlayer = "";

    async function adminLogin() {
      const id = document.getElementById("adminId").value.trim();
      const pass = document.getElementById("adminPass").value.trim();
      const res = await fetch(adminJsonURL);
      const admin = await res.json();
      if (id === admin.id && pass === admin.pass) {
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("adminPanel").classList.remove("hidden");
        loadData();
      } else alert("‚ùå Invalid Admin Credentials");
    }

    async function loadData() {
      const [taxRes, bankRes] = await Promise.all([fetch(taxURL), fetch(bankURL)]);
      taxData = await taxRes.json();
      bankData = await bankRes.json();
      renderPlayerList();
      renderBankList();
    }

    function renderPlayerList() {
      const container = document.getElementById("playerList");
      container.innerHTML = "";
      const players = Array.from(new Set([...Object.keys(taxData.paidPlayers || {}), ...Object.keys(bankData.accounts || {})]));

      players.forEach(player => {
        const paid = (taxData.paymentHistory?.[player] || []).reduce((sum, e) => sum + e.amount, 0);
        const total = taxData.paidPlayers?.[player] || 0;
        const due = Math.max(0, total - paid);
        const platform = player.includes('.') ? "Bedrock" : "Java";
        const status = due === 0 ? "‚úÖ No Due" : `‚ùå Due $${due.toFixed(2)}`;

        container.innerHTML += `
          <div class="player-box">
            <strong>${player}</strong> (${platform})<br>
            Status: ${status}<br>
            <label for="amt_${player}">Amount</label>
            <input id="amt_${player}" type="number" placeholder="Govt Pay Amount" />
            <label for="reason_${player}">Reason</label>
            <input id="reason_${player}" placeholder="Reason (optional)" />
            <label for="pass_${player}">Admin Password</label>
            <input id="pass_${player}" type="password" placeholder="Confirm Admin Pass to Reset" />
            <button onclick="payGovt('${player}')">üí∏ Pay as Govt</button>
            <button onclick="resetTax('${player}')">üóë Reset Tax</button>
            <button onclick="resetDeadline('${player}')">‚è± Reset Deadline</button>
          </div>`;
      });
    }

    function renderBankList() {
      const container = document.getElementById("bankList");
      container.innerHTML = "";
      const players = Array.from(new Set([...Object.keys(taxData.paidPlayers || {}), ...Object.keys(bankData.accounts || {})]));

      players.forEach(player => {
        const acc = bankData.accounts?.[player] || {};
        const username = acc.username || "N/A";
        const id = acc.id || "N/A";
        const pass = acc.password || "N/A";
        const contact = acc.contact || "N/A";

        container.innerHTML += `
          <div class="player-box">
            <strong>${player}</strong><br>
            Username: ${username}<br>
            ID: ${id}<br>
            Password: ${pass}<br>
            Contact: ${contact}<br>
          </div>`;
      });
    }

    function payGovt(player) {
      const amt = parseFloat(document.getElementById(`amt_${player}`).value);
      const reason = document.getElementById(`reason_${player}`).value || "No reason";
      if (!amt || amt <= 0) return alert("‚ùå Invalid amount");

      const entry = { amount: amt, date: new Date().toLocaleString(), adminNote: reason };
      taxData.paymentHistory[player] = taxData.paymentHistory[player] || [];
      taxData.paymentHistory[player].unshift(entry);
      taxData.paidPlayers[player] = (taxData.paidPlayers[player] || 0) + amt;
      alert("‚úÖ Govt Payment Applied");
      renderPlayerList();
    }

    function resetTax(player) {
      const pass = document.getElementById(`pass_${player}`).value.trim();
      if (!pass) return alert("‚ùå Admin password required");
      if (pass !== document.getElementById("adminPass").value.trim()) return alert("‚ùå Incorrect Admin Password");

      taxData.paymentHistory[player] = [];
      taxData.paidPlayers[player] = 0;
      alert("‚úÖ Tax Reset");
      renderPlayerList();
    }

    function resetDeadline(player) {
      delete taxData.taxDeadline?.[player];
      alert("‚úÖ Deadline Reset");
    }

    function syncData(type) {
      const url = type === "tax" ? syncTaxURL : syncBankURL;
      const data = type === "tax"
        ? { paidPlayers: taxData.paidPlayers, paymentHistory: taxData.paymentHistory, taxDeadline: taxData.taxDeadline }
        : { accounts: bankData.accounts };

      fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      }).then(r => {
        if (r.ok) alert(`‚úÖ ${type.toUpperCase()} Synced`);
        else r.text().then(t => alert("‚ùå Failed: " + t));
      });
    }

    function showSection(id) {
      ["taxPayments", "bankInfo"].forEach(s => document.getElementById(s).classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
    }
  </script>
</body>
</html>
