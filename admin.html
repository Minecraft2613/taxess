<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üõ†Ô∏è Admin Panel</title>
  <style>
    body {
      background: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    h2, h3 {
      color: orange;
      text-shadow: 0 0 5px orange;
    }
    input, button {
      padding: 8px;
      margin: 6px;
      border-radius: 5px;
      border: none;
    }
    input {
      background: #111;
      color: #fff;
    }
    button {
      background: orange;
      color: black;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      background: gold;
    }
    .section {
      margin: 20px 0;
      padding: 10px;
      border: 1px solid #444;
      border-radius: 6px;
      background: #111;
      box-shadow: 0 0 8px orange;
    }
    .hidden {
      display: none;
    }
    .player-box {
      background: #111;
      border: 1px solid #333;
      border-radius: 5px;
      margin: 10px 0;
      padding: 10px;
      box-shadow: 0 0 6px orange;
    }
  </style>
</head>
<body>
  <div id="loginBox">
    <h2>üîê Admin Login</h2>
    <input id="adminId" placeholder="Admin ID">
    <input id="adminPass" type="password" placeholder="Password">
    <button onclick="adminLogin()">Login</button>
  </div>

  <div id="adminPanel" class="hidden">
    <h2>üõ†Ô∏è Admin Panel</h2>
    <button onclick="showSection('playerTax')">Player Tax Payment</button>
    <button onclick="showSection('bankInfo')">Bank Info</button>
    <button onclick="syncData('tax')">Sync Tax</button>
    <button onclick="syncData('bank')">Sync Bank</button>
    <button onclick="location.reload()">Exit</button>

    <div id="playerTax" class="section hidden">
      <h3>All Players</h3>
      <div id="playerList"></div>
    </div>

    <div id="bankInfo" class="section hidden">
      <h3>Bank Information</h3>
      <div id="bankList"></div>
    </div>
  </div>

  <script>
    const adminJsonURL = "https://raw.githubusercontent.com/Minecraft2613/taxess/main/admin.json";
    const taxURL = "https://raw.githubusercontent.com/Minecraft2613/taxess/main/tax-data.json";
    const bankURL = "https://raw.githubusercontent.com/Minecraft2613/taxess/main/bank-data.json";
    const syncTaxURL = "https://syncs.1987sakshamsingh.workers.dev/";
    const syncBankURL = "https://b-syncs.1987sakshamsingh.workers.dev/";

    let taxData = {}, bankData = {}, currentAdminPass = "";

    async function adminLogin() {
      const id = document.getElementById("adminId").value.trim();
      const pass = document.getElementById("adminPass").value.trim();
      try {
        const res = await fetch(adminJsonURL);
        const admin = await res.json();
        if (id === admin.id && pass === admin.pass) {
          currentAdminPass = pass;
          document.getElementById("loginBox").style.display = "none";
          document.getElementById("adminPanel").classList.remove("hidden");
          loadData();
        } else {
          alert("‚ùå Invalid Admin Credentials");
        }
      } catch {
        alert("‚ùå Failed to load admin data");
      }
    }

    async function loadData() {
      const [taxRes, bankRes] = await Promise.all([fetch(taxURL), fetch(bankURL)]);
      taxData = await taxRes.json();
      bankData = await bankRes.json();
      renderPlayers();
      renderBanks();
    }

    function renderPlayers() {
      const container = document.getElementById("playerList");
      container.innerHTML = "";
      const players = Array.from(new Set([...Object.keys(taxData.paidPlayers || {}), ...Object.keys(bankData.accounts || {})]));

      players.forEach(player => {
        const paid = (taxData.paymentHistory?.[player] || []).reduce((sum, e) => sum + e.amount, 0);
        const total = taxData.paidPlayers?.[player] || 0;
        const due = Math.max(0, total - paid);
        const platform = player.includes('.') ? "Bedrock" : "Java";
        const status = due === 0 ? "‚úÖ No Due" : `‚ùå Due: $${due.toFixed(2)}`;

        container.innerHTML += `
          <div class='player-box'>
            <strong>${player}</strong> (${platform})<br>
            ${status}<br>
            <input id='amt_${player}' type='number' placeholder='Amount to pay as Govt'>
            <input id='reason_${player}' placeholder='Reason (optional)'>
            <input id='pass_${player}' type='password' placeholder='Confirm Admin Password'>
            <button onclick="payGovt('${player}')">Pay as Govt</button>
            <button onclick="resetTax('${player}')">Reset Tax</button>
            <button onclick="resetDeadline('${player}')">Reset Deadline</button>
          </div>`;
      });
    }

    function renderBanks() {
      const container = document.getElementById("bankList");
      container.innerHTML = "";
      Object.keys(bankData.accounts || {}).forEach(player => {
        const acc = bankData.accounts[player];
        container.innerHTML += `
          <div class='player-box'>
            <strong>${player}</strong><br>
            Username: ${acc.username || "N/A"}<br>
            ID: ${acc.id || "N/A"}<br>
            Password: ${acc.password || "N/A"}<br>
            Contact: ${acc.contact || "N/A"}<br>
          </div>`;
      });
    }

    function payGovt(player) {
      const amt = parseFloat(document.getElementById(`amt_${player}`).value);
      const reason = document.getElementById(`reason_${player}`).value || "No reason";
      if (!amt || amt <= 0) return alert("‚ùå Invalid amount");

      const entry = { amount: amt, date: new Date().toLocaleString(), adminNote: reason };
      taxData.paymentHistory[player] = taxData.paymentHistory[player] || [];
      taxData.paymentHistory[player].unshift(entry);
      taxData.paidPlayers[player] = (taxData.paidPlayers[player] || 0) + amt;
      alert("‚úÖ Payment Sent as Govt");
      renderPlayers();
    }

    function resetTax(player) {
      const pass = document.getElementById(`pass_${player}`).value;
      if (pass !== currentAdminPass) return alert("‚ùå Incorrect Password");
      taxData.paymentHistory[player] = [];
      taxData.paidPlayers[player] = 0;
      alert("‚úÖ Tax Reset");
      renderPlayers();
    }

    function resetDeadline(player) {
      if (taxData.taxDeadline && taxData.taxDeadline[player]) delete taxData.taxDeadline[player];
      alert("‚úÖ Deadline Reset");
    }

    function showSection(id) {
      document.getElementById("playerTax").classList.add("hidden");
      document.getElementById("bankInfo").classList.add("hidden");
      document.getElementById(id).classList.remove("hidden");
    }

    function syncData(type) {
      const url = type === "tax" ? syncTaxURL : syncBankURL;
      const data = type === "tax" ? {
        paidPlayers: taxData.paidPlayers,
        paymentHistory: taxData.paymentHistory,
        taxDeadline: taxData.taxDeadline || {}
      } : {
        accounts: bankData.accounts
      };

      fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      }).then(r => {
        if (r.ok) alert(`‚úÖ ${type.toUpperCase()} Synced`);
        else r.text().then(t => alert("‚ùå Failed: " + t));
      });
    }
  </script>
</body>
</html>
